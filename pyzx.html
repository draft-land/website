<html lang="en">

<head>
<meta charset="utf-8">
<title>PyZX Demo</title>
<link rel="stylesheet" type="text/css" href="/css/normalize.css">
<link rel="stylesheet" type="text/css" href="/css/intro.css">
<style>

body {
    font-size: 20px;
}

#console {
  background-color:#121;
  color: #EEE;
  font-size:12px;
  font-weight:700;
  width: 30vw;
  height: 280px;
}

#editor { 
        min-width: 400px;
        width: 40vw;
        height: 300px;
        float: left;
        margin-right: 50px;
        font-size: 16px;
    }

#display-content {
    min-height: 350px;
    min-width: 700px;
    width: 70%;
    margin: 1px;
    display: inline-block;
    overflow:auto;
    border: 1px solid black;
}

div.example{
    margin-top: 2em;
    display: none;
}


button{
    background-color: #dadada;
    color: #113;
    border-style: solid;
    border-color: #000;
    border-width: 1px;
    border-radius: 3px;
    font-size: 1.2em;
}
button.btn-ls{
    font-size: 1em;
}

</style>

</head>

<body onload="brython({debug: 0, indexedDB: true})">

<h2>PyZX Demo</h2>
<br></br>

<div class="header">
    <a href="/">Home</a>
    <a href="/publications.html">Publications</a>
    <a href="/colours.html">Accessibility</a>
    <a href="/map.html">Map</a>
</div>

<div style="display:table; width:100%;">
    <div style="display: table-row">
        <div style="display: table-cell; width:15%; vertical-align: top;">
            <h3>Examples</h3>
            <ul id="menu" style="margin-right:20px;">
            </ul>
        </div>

        <div style="display: inline-block; overflow:auto;border: 1px solid black;">
            <div id="editor"></div>
            <div style="display: inline-block;overflow:auto;"><span>Console output:</span><br>
            <textarea id="console"></textarea>
            </div>
        </div>
        <br></br>
        <button id="run-button">Run Code</button>
        <br></br>
        <div id="display-content">
        Loading PyZX. This can take a few seconds.
        </div>

    </div>
</div>


<div class="example" id="ex0">
    <button>Manually constructing a ZX-diagram</button>
    <script type="text/template">
        g = zx.Graph()
        #add_vertex(vertex_type, qubit_num, row_num, phase)
        i = g.add_vertex(0, 0, 0)
        v = g.add_vertex(1, 0, 1, Fraction(1,2))
        w = g.add_vertex(2, 0, 2, Fraction(-1,2))
        o = g.add_vertex(0, 0, 3)
        g.add_edges([(i,v),(v,w),(w,o)])
        display(zx.draw(g))
    </script>
</div>

<div class="example" id="ex1">
    <button>Generating and simplifying a Circuit</button>
    <script type="text/template">
        g = zx.generate.cliffordT(3,20)
        display(zx.draw(g))
        zx.simplify.full_reduce(g)
        g.normalise()
        display(zx.draw(g))
    </script>
</div>

<div class="example" id="ex2">
    <button>Converting ZX-diagram to tikz</button>
    <script type="text/template">
        g = zx.generate.cliffordT(3,10)
        display(g)
        display(zx.tikz.to_tikz(g))
    </script>
</div>



<script type="text/python">
    from browser import window
    editor = window.ace.edit("editor")
    editor.setTheme("ace/theme/monokai")
    session = editor.getSession()
    session.setMode("ace/mode/python")
</script>

<script type="text/python">
    from browser import document, html, window

    editor = window.ace.edit("editor")

    current = None

    def load_example(ev):
        global current
        if current is not None:
            document["a"+current].style.fontWeight = "normal"
        example_id = ev.target.num
        ev.target.style.fontWeight = "bold"

        example = document[example_id]
        src = example.get(selector="script")[0].text
        while src.startswith("\n"):
            src = src[1:]
        indent = 0
        while src[indent] == ' ':
            indent += 1
        src = "\n".join(line[indent:] for line in src.split("\n"))

        editor.setValue(src)

        current = example_id



    for example in document.get(selector=".example"):
        button = example.get(selector="button")[0]
        anchor = html.A(button.text, Class="menu", href="#", id="a"+example.id)
        anchor.num = example.id

        anchor.bind("click", load_example)
        document["menu"] <= html.LI(anchor)



</script>

<script type="text/python">
    import javascript
    from browser import document as doc, window, alert, html, timer

    import traceback
    import sys
    from fractions import Fraction

    editor = window.ace.edit("editor")

    editor.setValue("""g = zx.generate.cliffordT(3,20)\ndisplay(zx.draw(g))\nzx.simplify.full_reduce(g)\ng.normalise()\ndisplay(zx.draw(g))""")

    import pyzx as zx

    div_display = doc["display-content"]
    div_display.html = ""
    button = doc["run-button"]
    console = doc["console"]

    class cOutput:
        encoding = 'utf-8'

        def __init__(self):
            self.cons = console
            self.buf = ''

        def write(self, data):
            self.buf += str(data)

        def flush(self):
            self.cons.value += self.buf
            self.buf = ''

        def reset(self):
            self.buf = ''
            self.cons.value = ''

        def __len__(self):
            return len(self.buf)

    cOut = cOutput()
    sys.stdout = cOut
    sys.stderr = cOut

    def display(item, raw=False):
        if isinstance(item, str):
            if raw:
                div_display.html += item
            else:
                div_display.html += "<pre>" + item + "</pre>"
            return
        elif hasattr(item, "to_tensor"): # It is a circuit or graph
            item = zx.draw(item)
        for e in item:
            div_display <= e

    def respond(ev=None):
        button.innerHTML = "Running..."
        cOut.reset()
        div_display.html = ""
        timer.set_timeout(run_code,0) # Give control back to browser
        #

    def run_code():
        content = editor.getValue()
        content += "\nNone" # Hack to make it be an expression, and not a statement
        try:
            eval(content)
        except Exception as exc:
            traceback.print_exc(file=sys.stderr)
        sys.stdout.flush()
        button.innerHTML = "Run Code"

    button.bind('click', respond)

    timer.set_timeout(respond,0)
</script>


<script src="js/require.js"></script>
<script src="js/main.js"></script>


<script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ace/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ace/mode-python.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ace/snippets/python.js" type="text/javascript" charset="utf-8"></script>

<script src="js/brython.js"></script>
<script src="js/brython_modules.js"></script>

</body>

</html>